---

# แอปพลิเคชันควบคุมหุ่นยนต์

นี่คือแอปพลิเคชัน Flutter ที่ออกแบบมาเพื่อควบคุมหุ่นยนต์โดยใช้ **บลูทูธ** หรือ **WiFi** อินเทอร์เฟซใช้งานง่าย มีปุ่มควบคุมทิศทาง การปรับความเร็ว และตัวเลือกในการดูวิดีโอจากกล้อง รวมถึงเปิดใช้งานโหมดติดตามเส้น แอปพลิเคชันรองรับหลายภาษา หลายธีม และการตั้งค่าต่าง ๆ จะถูกบันทึกไว้

## คุณสมบัติ

* **การควบคุมทิศทาง**: คำสั่งเดินหน้า, ถอยหลัง, เลี้ยวซ้าย, เลี้ยวขวา และหยุด
* **การควบคุมความเร็ว**: แถบเลื่อนปรับความเร็วได้
* **ตัวเลือกการเชื่อมต่อ**:
    * **บลูทูธคลาสสิก**: เชื่อมต่อกับอุปกรณ์ต่างๆ เช่น Arduino ที่มีโมดูล HC-05/06 หรือ ESP32 ที่มีบลูทูธในตัว
    * **WiFi (HTTP)**: เชื่อมต่อกับ ESP32 ที่ทำหน้าที่เป็นเว็บเซิร์ฟเวอร์ เหมาะสำหรับ ESP32-CAM
* **โหมดหุ่นยนต์**:
    * **การควบคุมแบบแมนนวล**
    * **โหมดติดตามเส้น** (เปิดใช้งานโหมดอัตโนมัติบนหุ่นยนต์)
    * **มุมมองกล้อง** (แสดงสตรีมจาก ESP32-CAM ผ่าน HTTP)
* **อินเทอร์เฟซที่ปรับแต่งได้**: สลับการแสดงผลของแถบเลื่อนความเร็ว, ปุ่มติดตามเส้น และปุ่มกล้อง
* **การตั้งค่ากล้อง**: กำหนดความกว้าง, ความสูง, ความสว่าง, การหมุน, การซูมของภาพ และประเภทสตรีม (JPEG หรือ MJPEG)
* **รองรับหลายภาษา**: ภาษาอังกฤษ, ภาษาไทย และภาษาจีน
* **ธีม**: ธีมสว่าง, ธีมมืด, ธีมสีน้ำเงิน และธีมสีเขียว
* **การตั้งค่าที่บันทึกถาวร**: การกำหนดค่าทั้งหมดจะถูกบันทึกโดยใช้ `shared_preferences`
* **การจัดการสิทธิ์**: ร้องขอสิทธิ์บลูทูธที่จำเป็นเมื่อรันไทม์
* **การแจ้งเตือนข้อผิดพลาด**: ให้ข้อความแสดงข้อผิดพลาดที่ชัดเจนสำหรับปัญหาการเชื่อมต่อพร้อมตัวเลือกในการเปิดการตั้งค่าอุปกรณ์ที่เกี่ยวข้อง

---

## เริ่มต้นใช้งาน

### ข้อกำหนดเบื้องต้น

ก่อนที่จะรันแอปพลิเคชัน ตรวจสอบให้แน่ใจว่าคุณมีสิ่งเหล่านี้:

* **Flutter SDK** ติดตั้งแล้ว
* **Android Studio** หรือ **VS Code** พร้อมปลั๊กอิน Flutter และ Dart
* อุปกรณ์ Android จริง หรืออีมูเลเตอร์สำหรับการทดสอบ
* สำหรับบลูทูธ: บอร์ด Arduino (เช่น Uno, Nano) ที่มีโมดูลบลูทูธ HC-05/HC-06 หรือ ESP32
* สำหรับ WiFi และกล้อง: บอร์ด ESP32-CAM
* สิทธิ์ที่จำเป็นสำหรับแอป: การเข้าถึงบลูทูธและเครือข่าย (อินเทอร์เน็ต)

### 1. การตั้งค่าแอป Flutter (main.dart)

1.  โคลน repository นี้ หรือสร้างโปรเจกต์ Flutter ใหม่ และคัดลอกโค้ด `main.dart` ลงในโฟลเดอร์ `lib` ของคุณ
2.  ตรวจสอบให้แน่ใจว่าคุณมี dependencies ที่จำเป็นใน `pubspec.yaml` ของคุณ:

    ```yaml
    dependencies:
      flutter:
        sdk: flutter
      flutter_localizations:
        sdk: flutter
      flutter_bluetooth_serial: ^0.4.0 # สำหรับการสื่อสารบลูทูธ
      shared_preferences: ^2.2.3 # สำหรับบันทึกการตั้งค่าแอป
      http: ^1.2.1 # สำหรับการสื่อสาร WiFi (HTTP)
      flutter_launcher_icons: ^0.13.1 # ไม่บังคับ: สำหรับไอคอนแอป
      flutter_native_splash: ^2.4.0 # ไม่บังคับ: สำหรับหน้าจอ Splash
      flutter/services.dart # เป็นส่วนหนึ่งของ Flutter อยู่แล้ว
      app_settings: ^5.1.0 # สำหรับเปิดการตั้งค่าอุปกรณ์
      permission_handler: ^11.3.1 # สำหรับตรวจสอบและร้องขอสิทธิ์

    dev_dependencies:
      flutter_test:
        sdk: flutter
      flutter_lints: ^3.0.0
    ```

3.  รัน `flutter pub get` ในไดเรกทอรีโปรเจกต์ของคุณเพื่อติดตั้ง dependencies
4.  เพิ่มรูปภาพลูกศร (`arrow_up.png`, `arrow_down.png`, `arrow_left.png`, `arrow_right.png`) ไปยังโฟลเดอร์ `assets/images/` ในรูทโปรเจกต์ของคุณ และประกาศใน `pubspec.yaml`:

    ```yaml
    flutter:
      uses-material-design: true
      assets:
        - assets/images/arrow_up.png
        - assets/images/arrow_down.png
        - assets/images/arrow_left.png
        - assets/images/arrow_right.png
    ```

5.  **สำคัญ**: ตรวจสอบให้แน่ใจว่าคลาส `SettingsPage` และ `_SettingsPageState` ถูกกำหนดที่ **ระดับบนสุด** ของไฟล์ `main.dart` ของคุณ ไม่ได้อยู่ภายใน `_ControlPageState` หรือคลาสอื่น ๆ (ไฟล์ `main.dart` ที่ให้ไว้ก่อนหน้านี้ได้รับการแก้ไขแล้ว)

### 2. การตั้งค่าเฟิร์มแวร์หุ่นยนต์ (Arduino IDE)

เลือกโค้ดที่เหมาะสมสำหรับฮาร์ดแวร์หุ่นยนต์ของคุณ:

#### ตัวเลือก A: ESP32 พร้อม WiFi (สำหรับ ESP32-CAM หรือการควบคุม WiFi ทั่วไป)

โค้ดนี้จะทำให้ ESP32-CAM ของคุณทำหน้าที่เป็น Access Point โดยโฮสต์เว็บเซิร์ฟเวอร์สำหรับคำสั่งควบคุมและการสตรีมวิดีโอ MJPEG

1.  **ติดตั้งบอร์ด ESP32**:
    * เปิด Arduino IDE ไปที่ `File > Preferences > Additional Boards Manager URLs`
    * เพิ่ม: `https://raw.githubusercontent.com/espressif/arduino-esp32/gh-pages/package_esp32_index.json`
    * ไปที่ `Tools > Board > Boards Manager` ค้นหา "esp32" และติดตั้ง "esp32 by Espressif Systems"
2.  **ติดตั้งไลบรารี ESP32 Camera**: โดยปกติจะรวมอยู่ในแพ็คเกจบอร์ด ESP32 แล้ว แต่ตรวจสอบให้แน่ใจว่ามีอยู่
3.  **เลือกบอร์ด**: ไปที่ `Tools > Board > ESP32 Arduino` และเลือก `AI Thinker ESP32-CAM`
4.  **อัปโหลดโค้ด**: คัดลอกโค้ด "ESP32 สำหรับ WiFi + Camera (MJPEG Stream)" ลงใน Arduino IDE และอัปโหลดไปยัง ESP32-CAM ของคุณ
    * **หมายเหตุ**: คุณอาจต้องกดปุ่ม `RST` บน ESP32-CAM ระหว่างการอัปโหลดหากล้มเหลว
5.  **การกำหนดค่า**:
    * ปรับ `ssid` และ `password` ในโค้ด ESP32 หากคุณต้องการเปลี่ยนชื่อ/รหัสผ่าน AP
    * หลังจากอัปโหลด ให้เปิด Serial Monitor (Baud Rate: 115200) เพื่อค้นหาที่อยู่ IP ของ ESP32 คุณจะป้อน IP นี้ในการตั้งค่าแอป Flutter

#### ตัวเลือก B: Arduino Uno/Nano พร้อมโมดูลบลูทูธ (เช่น HC-05/HC-06)

โค้ดนี้จะช่วยให้ Arduino ของคุณรับคำสั่งผ่านโมดูลบลูทูธที่เชื่อมต่ออยู่

1.  **การเชื่อมต่อฮาร์ดแวร์ (HC-05/HC-06 ไปยัง Arduino Uno/Nano)**:
    * `HC-05/06 VCC` -> `Arduino 5V`
    * `HC-05/06 GND` -> `Arduino GND`
    * `HC-05/06 TX` -> `Arduino Digital Pin 10` (หรือ `RX` pin หากใช้ฮาร์ดแวร์ซีเรียล แต่ต้องถอดการเชื่อมต่อเพื่ออัปโหลด)
    * `HC-05/06 RX` -> `Arduino Digital Pin 11` (หรือ `TX` pin หากใช้ฮาร์ดแวร์ซีเรียล)
        * **สำคัญ**: สำหรับ HC-05/06 `RX` ไปยัง Arduino `TX` (ซึ่งเป็น 5V) คุณ **ต้องใช้ตัวแบ่งแรงดันไฟฟ้า** (เช่น ตัวต้านทานสองตัว, 1kΩ และ 2kΩ) เพื่อลดสัญญาณ 5V จาก Arduino ลงเป็น 3.3V ที่โมดูลบลูทูธคาดหวัง การไม่ทำเช่นนั้นอาจทำให้โมดูลเสียหายได้
2.  **ติดตั้งไลบรารี `SoftwareSerial`**: นี่คือไลบรารีมาตรฐานของ Arduino โดยปกติจะติดตั้งมาล่วงหน้า
3.  **อัปโหลดโค้ด**: คัดลอกโค้ด "สำหรับ Arduino Uno/Nano (ใช้ `SoftwareSerial`)" ลงใน Arduino IDE และอัปโหลดไปยังบอร์ด Arduino ของคุณ
    * **หมายเหตุ**: หากคุณใช้ขา Serial ฮาร์ดแวร์ (0 และ 1) สำหรับโมดูลบลูทูธ ให้ถอดการเชื่อมต่อโมดูลระหว่างการอัปโหลดโค้ดเพื่อป้องกันการรบกวน
4.  **การจับคู่**: บนอุปกรณ์ Android ของคุณ ให้ไปที่การตั้งค่าบลูทูธและจับคู่กับโมดูล HC-05/HC-06 ของคุณ (โดยปกติจะชื่อ "HC-05" หรือ "HC-06" รหัส PIN เริ่มต้นคือ "1234" หรือ "0000") จากนั้นแอป Flutter จะสามารถเชื่อมต่อกับอุปกรณ์ที่จับคู่นี้ได้

#### ตัวเลือก C: ESP32 พร้อมบลูทูธคลาสสิกในตัว

โค้ดนี้ใช้ประโยชน์จากความสามารถบลูทูธดั้งเดิมของ ESP32

1.  **ติดตั้งบอร์ด ESP32**: ทำตามขั้นตอนที่ 1 จาก "ตัวเลือก A" ข้างบน
2.  **อัปโหลดโค้ด**: คัดลอกโค้ด "สำหรับ ESP32 (ใช้ Bluetooth Classic Built-in)" ลงใน Arduino IDE และอัปโหลดไปยัง ESP32 ของคุณ
3.  **การจับคู่**: บนอุปกรณ์ Android ของคุณ ให้ไปที่การตั้งค่าบลูทูธและจับคู่กับอุปกรณ์ที่ชื่อ "ESP32_Robot" (หรือชื่อที่คุณตั้งค่าไว้ใน `SerialBT.begin()`)

---

## การรันแอปพลิเคชัน

1.  ตรวจสอบให้แน่ใจว่าบอร์ดหุ่นยนต์ของคุณ (ESP32-CAM หรือ Arduino ที่มีบลูทูธ) เปิดอยู่และรันเฟิร์มแวร์ที่ถูกต้อง
2.  เชื่อมต่ออุปกรณ์ Android ของคุณเข้ากับคอมพิวเตอร์
3.  เปิดเทอร์มินัลหรือ Command Prompt ของคุณ นำทางไปยังไดเรกทอรีโปรเจกต์ Flutter ของคุณ
4.  รัน `flutter run` เพื่อติดตั้งแอปพลิเคชันลงบนอุปกรณ์ของคุณ
    * หากคุณมีอุปกรณ์หลายเครื่อง ให้ใช้ `flutter run -d <device_id>` (รับ ID อุปกรณ์จาก `flutter devices`)

---

## การใช้งาน

1.  **สิทธิ์ของแอป**: ในการเปิดใช้งานครั้งแรก แอปจะขอสิทธิ์บลูทูธ อนุญาตสิทธิ์เหล่านั้น
2.  **การตั้งค่า**:
    * แตะ **ไอคอนการตั้งค่า** (รูปเฟือง) ใน AppBar
    * **แสดงแถบเลื่อนความเร็ว, แสดงปุ่มติดตามเส้น, แสดงปุ่มกล้อง**: สลับสิ่งเหล่านี้เพื่อปรับแต่งหน้าจอควบคุมหลัก
    * **ใช้ WiFi แทนบลูทูธ**: เลือกช่องนี้หากหุ่นยนต์ของคุณใช้ WiFi (เช่น ESP32-CAM)
    * **WiFi IP**: หากเปิดใช้งาน "ใช้ WiFi" ให้ป้อนที่อยู่ IP ของ ESP32 ของคุณที่นี่ (เช่น `192.168.4.1`)
    * **การตั้งค่ารูปภาพ**: ปรับพารามิเตอร์กล้องสำหรับ ESP32-CAM
    * แตะ **บันทึก** เพื่อใช้การเปลี่ยนแปลง
3.  **การควบคุม**:
    * ใช้ **ปุ่มลูกศร** เพื่อส่งคำสั่งทิศทาง
    * ใช้ **ปุ่ม STOP** เพื่อหยุดการเคลื่อนไหว
    * ปรับ **ความเร็ว** โดยใช้แถบเลื่อน (หากเปิดใช้งาน)
    * แตะ **ติดตามเส้น** เพื่อเปิดใช้งานโหมดติดตามเส้นบนหุ่นยนต์ (ต้องได้รับการสนับสนุนเฟิร์มแวร์หุ่นยนต์)
    * แตะ **ดูกล้อง** เพื่อเปิดสตรีมกล้อง (หากเชื่อมต่อกับ ESP32-CAM ผ่าน WiFi และเปิดใช้งาน)
4.  **ภาษาและธีม**:
    * แตะ **ไอคอนภาษา** (ลูกโลก) เพื่อเปลี่ยนภาษาของแอป
    * แตะ **ไอคอนธีม** (จานสี) เพื่อเปลี่ยนโทนสีของแอป
5.  **วิธีใช้**: แตะ **ไอคอนช่วยเหลือ** (เครื่องหมายคำถาม) สำหรับคำแนะนำฉบับย่อภายในแอป
6.  **การแจ้งเตือนข้อผิดพลาด**: หากมีปัญหาการเชื่อมต่อ **ไอคอนกระดิ่ง** จะปรากฏขึ้นใน AppBar แตะเพื่อดูข้อความแสดงข้อผิดพลาดและตัวเลือกในการเปิดการตั้งค่าอุปกรณ์ที่เกี่ยวข้อง

---

## การแก้ไขปัญหา

* **"ไม่ได้รับอนุญาตบลูทูธ"**: ไปที่การตั้งค่าแอปของอุปกรณ์ของคุณและตรวจสอบให้แน่ใจว่าได้เปิดใช้งานสิทธิ์บลูทูธสำหรับแอปนี้แล้ว
* **"บลูทูธปิดอยู่"**: เปิดบลูทูธในการตั้งค่าอุปกรณ์ของคุณ
* **"บลูทูธไม่ได้เชื่อมต่อ"**:
    * ตรวจสอบให้แน่ใจว่าโมดูลบลูทูธ/ESP32 ของคุณเปิดอยู่และสามารถค้นพบได้
    * จับคู่อุปกรณ์ Android ของคุณกับโมดูลบลูทูธในการตั้งค่า Android
    * สำหรับ ESP32 ตรวจสอบให้แน่ใจว่าชื่ออุปกรณ์บลูทูธในแอปตรงกับชื่อที่ตั้งค่าใน `SerialBT.begin()`
* **"ข้อผิดพลาดการเชื่อมต่อ WiFi"**:
    * ตรวจสอบให้แน่ใจว่า ESP32-CAM ของคุณเปิดอยู่และ Access Point กำลังทำงาน
    * เชื่อมต่ออุปกรณ์ Android ของคุณเข้ากับเครือข่าย WiFi ของ ESP32
    * ตรวจสอบว่าที่อยู่ IP ในการตั้งค่าแอปตรงกับที่อยู่ IP ของ ESP32
    * ตรวจสอบ Serial Monitor ของ ESP32 ของคุณสำหรับข้อผิดพลาดของเซิร์ฟเวอร์
* **ปัญหาสตรีมกล้อง**:
    * ตรวจสอบว่า `streamType` ในการตั้งค่าแอปถูกต้อง (`mjpeg` สำหรับสตรีมต่อเนื่อง)
    * ตรวจสอบว่า ESP32-CAM ทำงานอยู่และเซิร์ฟเวอร์กำลังทำงาน
* **มอเตอร์ไม่ตอบสนอง**:
    * ตรวจสอบ Serial Monitor บนบอร์ดหุ่นยนต์ของคุณเพื่อดูว่าได้รับคำสั่งหรือไม่
    * ตรวจสอบว่าโค้ดควบคุมมอเตอร์บนหุ่นยนต์ของคุณกำลังวิเคราะห์และดำเนินการตามคำสั่งที่ได้รับอย่างถูกต้อง
    * ตรวจสอบให้แน่ใจว่าไดรเวอร์มอเตอร์และมอเตอร์ของคุณเชื่อมต่อสายไฟและจ่ายไฟอย่างถูกต้อง

---

แอปพลิเคชันนี้สร้างโดย **[join845]**